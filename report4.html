<div class="cell code" data-execution_count="5">
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="op">!</span>pip install matplotlib</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Requirement already satisfied: matplotlib in ./env/lib/python3.8/site-packages (3.6.3)
Requirement already satisfied: numpy&gt;=1.19 in ./env/lib/python3.8/site-packages (from matplotlib) (1.24.0)
Requirement already satisfied: contourpy&gt;=1.0.1 in ./env/lib/python3.8/site-packages (from matplotlib) (1.0.7)
Requirement already satisfied: python-dateutil&gt;=2.7 in ./env/lib/python3.8/site-packages (from matplotlib) (2.8.2)
Requirement already satisfied: cycler&gt;=0.10 in ./env/lib/python3.8/site-packages (from matplotlib) (0.11.0)
Requirement already satisfied: pyparsing&gt;=2.2.1 in ./env/lib/python3.8/site-packages (from matplotlib) (3.0.9)
Requirement already satisfied: pillow&gt;=6.2.0 in ./env/lib/python3.8/site-packages (from matplotlib) (9.4.0)
Requirement already satisfied: fonttools&gt;=4.22.0 in ./env/lib/python3.8/site-packages (from matplotlib) (4.38.0)
Requirement already satisfied: packaging&gt;=20.0 in ./env/lib/python3.8/site-packages (from matplotlib) (22.0)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in ./env/lib/python3.8/site-packages (from matplotlib) (1.4.4)
Requirement already satisfied: six&gt;=1.5 in ./env/lib/python3.8/site-packages (from python-dateutil&gt;=2.7-&gt;matplotlib) (1.16.0)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="6">
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="im">import</span> math</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt   </span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="im">import</span> random  </span></code></pre></div>
</div>
<section id="情報計算科学の基礎" class="cell markdown">
<h1>情報計算科学の基礎</h1>
<p>レポート4</p>
</section>
<div class="cell markdown">
<p>(1) $ E(x) = 3(x-2)^4 + (x-2)^2 + 1 $を最小化するxをニュートン法で求める。</p>
<p>$ E'(x)/2 = 6(x-2)^3 + (x-2) $ なので、 $ E'(x)/2 = 0 $　となるx を求める。</p>
</div>
<div class="cell code" data-execution_count="7">
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>EPSILON <span class="op">=</span> <span class="fl">1e-8</span> <span class="co"># 0.0000001</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="8">
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">def</span> E_OBJ_FUNC(x) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb5-2"><a href="#cb5-2"></a>    <span class="cf">return</span> <span class="dv">6</span><span class="op">*</span>(x<span class="dv">-2</span>)<span class="op">**</span><span class="dv">3</span> <span class="op">+</span> (x<span class="dv">-2</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="kw">def</span> E_D_FUNC(x) <span class="op">-&gt;</span> <span class="bu">float</span> :</span>
<span id="cb5-5"><a href="#cb5-5"></a>    <span class="cf">return</span> <span class="dv">18</span><span class="op">*</span>(x <span class="op">-</span> <span class="dv">2</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="68">
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">def</span> calc_slice(liner_func):</span>
<span id="cb6-2"><a href="#cb6-2"></a>    <span class="cf">pass</span></span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="kw">def</span> solve_eq_1(objfunc,dfunc,dimension:<span class="bu">int</span> <span class="op">=</span> <span class="dv">1</span>) <span class="op">-&gt;</span> <span class="bu">float</span> :</span>
<span id="cb6-5"><a href="#cb6-5"></a>    x <span class="op">=</span> <span class="dv">20000</span><span class="op">*</span>( random.random() <span class="op">-</span> <span class="fl">0.5</span> )</span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="bu">print</span>(<span class="ss">f&#39;x:init:</span><span class="sc">{x}</span><span class="ss">&#39;</span>)</span>
<span id="cb6-7"><a href="#cb6-7"></a>    err <span class="op">=</span> objfunc(x)</span>
<span id="cb6-8"><a href="#cb6-8"></a>    <span class="cf">while</span> <span class="bu">abs</span>(err) <span class="op">&gt;</span> EPSILON:</span>
<span id="cb6-9"><a href="#cb6-9"></a>        x_formar <span class="op">=</span> x</span>
<span id="cb6-10"><a href="#cb6-10"></a>        x <span class="op">=</span> x_formar <span class="op">-</span> (objfunc(x_formar) <span class="op">/</span> dfunc(x_formar))</span>
<span id="cb6-11"><a href="#cb6-11"></a>        err <span class="op">=</span> objfunc(x)</span>
<span id="cb6-12"><a href="#cb6-12"></a>    </span>
<span id="cb6-13"><a href="#cb6-13"></a>    <span class="bu">print</span>(<span class="ss">f&#39;err:</span><span class="sc">{</span>err<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb6-14"><a href="#cb6-14"></a>    <span class="bu">print</span>(<span class="ss">f&#39;x:</span><span class="sc">{x}</span><span class="ss">&#39;</span>)</span>
<span id="cb6-15"><a href="#cb6-15"></a></span>
<span id="cb6-16"><a href="#cb6-16"></a>    <span class="cf">return</span> x</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="47">
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="bu">print</span>(solve_eq_1(E_OBJ_FUNC,E_D_FUNC))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>x:init:92.88988434797676
err:0.0
x:2.0
2.0
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="76">
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="bu">print</span>(solve_eq_1(E_OBJ_FUNC,E_D_FUNC))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>x:init:-8002.999486444318
err:0.0
x:2.0
2.0
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>かなり早いスピードで $ x=2 $ に収束した。また、初期値がかなり大きくても早いスピードで収束した。</p>
</div>
<div class="cell markdown">
<p>(2)</p>
</div>
<div class="cell code" data-execution_count="16">
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">def</span> F_OBJ_FUNC(x) <span class="op">-&gt;</span> <span class="bu">list</span>:</span>
<span id="cb11-2"><a href="#cb11-2"></a>    ans <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb11-3"><a href="#cb11-3"></a>    ans[<span class="dv">0</span>] <span class="op">=</span> (<span class="dv">6</span><span class="op">*</span>(x[<span class="dv">0</span>]<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="dv">6</span><span class="op">*</span>(x[<span class="dv">0</span>]<span class="op">-</span><span class="dv">3</span>)<span class="op">*</span>(x[<span class="dv">1</span>]<span class="op">-</span><span class="dv">2</span>)<span class="op">**</span><span class="dv">2</span>)    </span>
<span id="cb11-4"><a href="#cb11-4"></a>    ans[<span class="dv">1</span>] <span class="op">=</span> (<span class="dv">6</span><span class="op">*</span>(x[<span class="dv">1</span>]<span class="op">-</span><span class="dv">2</span>)<span class="op">*</span>(x[<span class="dv">0</span>]<span class="op">-</span><span class="dv">3</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">8</span><span class="op">*</span>(x[<span class="dv">1</span>]<span class="op">-</span><span class="dv">2</span>))</span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="cf">return</span> ans</span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="kw">def</span> F_D_FUNC(x) <span class="op">-&gt;</span> <span class="bu">list</span> :</span>
<span id="cb11-8"><a href="#cb11-8"></a>    ans <span class="op">=</span>[[<span class="dv">0</span>,<span class="dv">0</span>],[<span class="dv">0</span>,<span class="dv">0</span>]]</span>
<span id="cb11-9"><a href="#cb11-9"></a>    ans[<span class="dv">0</span>][<span class="dv">0</span>] <span class="op">=</span> <span class="dv">6</span><span class="op">*</span>((x[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">2</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb11-10"><a href="#cb11-10"></a>    ans[<span class="dv">0</span>][<span class="dv">1</span>] <span class="op">=</span> <span class="dv">12</span><span class="op">*</span>(x[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">3</span>)<span class="op">*</span>(x[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">2</span>)</span>
<span id="cb11-11"><a href="#cb11-11"></a>    ans[<span class="dv">1</span>][<span class="dv">0</span>] <span class="op">=</span> ans[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb11-12"><a href="#cb11-12"></a>    ans[<span class="dv">1</span>][<span class="dv">1</span>] <span class="op">=</span> <span class="dv">6</span><span class="op">*</span>(x[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">3</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">8</span></span>
<span id="cb11-13"><a href="#cb11-13"></a>    <span class="cf">return</span> ans</span>
<span id="cb11-14"><a href="#cb11-14"></a></span>
<span id="cb11-15"><a href="#cb11-15"></a></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="34">
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>EPSILON <span class="op">=</span> <span class="fl">1e-8</span> <span class="co"># 0.0000001</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co"># EPSILON = 0.1 # 0.1</span></span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="kw">def</span> inv_mat(A):</span>
<span id="cb12-5"><a href="#cb12-5"></a>    n_size_of_A <span class="op">=</span> <span class="bu">len</span>(A)</span>
<span id="cb12-6"><a href="#cb12-6"></a>    X <span class="op">=</span> np.eye(n_size_of_A)</span>
<span id="cb12-7"><a href="#cb12-7"></a>    <span class="co">#まずAを上三角行列にする。</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>    A <span class="op">=</span> A.astype(<span class="st">&#39;float64&#39;</span>)</span>
<span id="cb12-9"><a href="#cb12-9"></a>    <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(n_size_of_A):</span>
<span id="cb12-10"><a href="#cb12-10"></a>        pivot <span class="op">=</span> A[p][p]</span>
<span id="cb12-11"><a href="#cb12-11"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(p<span class="op">+</span><span class="dv">1</span>, n_size_of_A):</span>
<span id="cb12-12"><a href="#cb12-12"></a>            coef <span class="op">=</span> A[j][p] <span class="op">/</span> pivot</span>
<span id="cb12-13"><a href="#cb12-13"></a>            A[j] <span class="op">-=</span> A[p] <span class="op">*</span> coef</span>
<span id="cb12-14"><a href="#cb12-14"></a>            X[j] <span class="op">-=</span> X[p] <span class="op">*</span> coef</span>
<span id="cb12-15"><a href="#cb12-15"></a>    <span class="co">#途中経過確認。</span></span>
<span id="cb12-16"><a href="#cb12-16"></a>    <span class="co">#print(A)</span></span>
<span id="cb12-17"><a href="#cb12-17"></a>    <span class="co">#print(X)</span></span>
<span id="cb12-18"><a href="#cb12-18"></a>    <span class="co">#対角成分を1にする。</span></span>
<span id="cb12-19"><a href="#cb12-19"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_size_of_A):</span>
<span id="cb12-20"><a href="#cb12-20"></a>        X[i] <span class="op">/=</span> A[i][i]</span>
<span id="cb12-21"><a href="#cb12-21"></a>        A[i] <span class="op">/=</span> A[i][i]</span>
<span id="cb12-22"><a href="#cb12-22"></a>    <span class="co">#途中経過確認。</span></span>
<span id="cb12-23"><a href="#cb12-23"></a>    <span class="co">#print(A)</span></span>
<span id="cb12-24"><a href="#cb12-24"></a>    <span class="co">#print(X)</span></span>
<span id="cb12-25"><a href="#cb12-25"></a>    <span class="co">#答えを出す。</span></span>
<span id="cb12-26"><a href="#cb12-26"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_size_of_A<span class="dv">-1</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb12-27"><a href="#cb12-27"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i):</span>
<span id="cb12-28"><a href="#cb12-28"></a>            X[j] <span class="op">-=</span> X[i] <span class="op">*</span> A[j][i]</span>
<span id="cb12-29"><a href="#cb12-29"></a>            A[j][i] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-30"><a href="#cb12-30"></a>    <span class="cf">return</span> X</span>
<span id="cb12-31"><a href="#cb12-31"></a></span>
<span id="cb12-32"><a href="#cb12-32"></a><span class="kw">def</span> solve_eq_2(objfunc,dfunc,dimension:<span class="bu">int</span> <span class="op">=</span> <span class="dv">2</span>) <span class="op">-&gt;</span> <span class="bu">float</span> :</span>
<span id="cb12-33"><a href="#cb12-33"></a>    x <span class="op">=</span> <span class="dv">20000</span><span class="op">*</span>(np.random.rand(dimension) <span class="op">-</span> np.array(([<span class="dv">0</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(dimension)])) )</span>
<span id="cb12-34"><a href="#cb12-34"></a>    <span class="bu">print</span>(<span class="ss">f&#39;x:init:</span><span class="sc">{x}</span><span class="ss">&#39;</span>)</span>
<span id="cb12-35"><a href="#cb12-35"></a>    err <span class="op">=</span> objfunc(x)</span>
<span id="cb12-36"><a href="#cb12-36"></a>    <span class="cf">while</span> np.linalg.norm(np.array(err)) <span class="op">&gt;</span> EPSILON:</span>
<span id="cb12-37"><a href="#cb12-37"></a>        x_formar <span class="op">=</span> x</span>
<span id="cb12-38"><a href="#cb12-38"></a>        inv <span class="op">=</span> inv_mat(np.array( (dfunc(x_formar)) ))</span>
<span id="cb12-39"><a href="#cb12-39"></a>        x <span class="op">=</span> x_formar <span class="op">-</span> (inv <span class="op">@</span>   np.array( objfunc(x_formar) ) )</span>
<span id="cb12-40"><a href="#cb12-40"></a>        err <span class="op">=</span> objfunc(x)</span>
<span id="cb12-41"><a href="#cb12-41"></a>        <span class="co"># print(f&#39;err:{err}&#39;)</span></span>
<span id="cb12-42"><a href="#cb12-42"></a>        <span class="co"># print(f&#39;x:{x}&#39;)</span></span>
<span id="cb12-43"><a href="#cb12-43"></a>    </span>
<span id="cb12-44"><a href="#cb12-44"></a>    <span class="bu">print</span>(<span class="ss">f&#39;err:</span><span class="sc">{</span>err<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb12-45"><a href="#cb12-45"></a>    <span class="bu">print</span>(<span class="ss">f&#39;x:</span><span class="sc">{x}</span><span class="ss">&#39;</span>)</span>
<span id="cb12-46"><a href="#cb12-46"></a></span>
<span id="cb12-47"><a href="#cb12-47"></a>    <span class="cf">return</span> x</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="35">
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="bu">print</span>(solve_eq_2(F_OBJ_FUNC,F_D_FUNC))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>x:init:[19212.23383629 17477.89416071]
err:[5.329070518200751e-15, 2.842170943040401e-14]
x:[3. 2.]
[3. 2.]
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>なので、解は $ (x_1,x_2) = (3,2) $ これもかなり早いスピードで収束した。</p>
</div>
